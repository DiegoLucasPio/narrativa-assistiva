<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Narrativa Assistiva - Acessibilidade Total</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f4f8; text-align: center; padding: 10px; }
        .painel { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .btn { padding: 12px 18px; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; color: white; transition: 0.2s; font-size: 0.9rem; }
        .btn-v { background: #e74c3c; } .btn-a { background: #3498db; } .btn-g { background: #27ae60; } .btn-p { background: #9b59b6; } .btn-o { background: #f39c12; }
        
        .quadros { display: flex; justify-content: center; gap: 10px; margin: 15px 0; }
        .cena { width: 280px; background: white; border-radius: 12px; padding: 12px; border: 3px solid #cfe2ff; }
        .cena img { width: 100%; height: 160px; object-fit: cover; border-radius: 8px; }
        .cena strong { display: block; margin-top: 10px; color: #084298; }
        
        textarea { width: 90%; height: 200px; font-size: 1.7rem; padding: 15px; border: 4px solid #3498db; border-radius: 15px; margin-top: 10px; outline: none; }
        #status { margin: 10px; font-weight: bold; color: #2c3e50; background: #fff; display: inline-block; padding: 10px 25px; border-radius: 30px; border: 2px solid #3498db; min-height: 1.5em; }
        .alerta { background: #fff3cd !important; border-color: #ffc107 !important; color: #856404 !important; }
    </style>
</head>
<body>

    <div id="status">Pressione F1 para ouvir a descri√ß√£o das cenas.</div>

    <div class="painel">
        <button class="btn btn-a" onclick="cmdDescrever()">üñºÔ∏è DESCRI√á√ÉO (F1)</button>
        <button class="btn btn-g" onclick="cmdLer()">üìñ LER TEXTO (F2)</button>
        <button class="btn btn-p" onclick="cmdSinonimo()">üîÑ SIN√îNIMOS (F3)</button>
        <button class="btn btn-v" onclick="cmdRepetirDica()">üí° REPETIR DICA (F8)</button>
        <button class="btn btn-o" onclick="cmdSalvar()">üíæ SALVAR (F4)</button>
    </div>

    <div class="quadros">
        <div class="cena">
            <img src="https://images.unsplash.com/photo-1526772662000-3f88f10405ff?w=400" alt="Mapa antigo na floresta">
            <strong>1. A Descoberta</strong>
        </div>
        <div class="cena">
            <img src="https://images.unsplash.com/photo-1444076784383-69fc7bad9006?w=400" alt="Ponte de cordas alta">
            <strong>2. A Travessia</strong>
        </div>
        <div class="cena">
            <img src="https://images.unsplash.com/photo-1589923158776-cb4485d99fd6?w=400" alt="Ba√∫ de ouro em caverna brilhante">
            <strong>3. O Tesouro</strong>
        </div>
    </div>

    <textarea id="txt" placeholder="Comece a escrever sua hist√≥ria aqui..."></textarea>

    <script>
        const campo = document.getElementById('txt');
        const status = document.getElementById('status');
        const synth = window.speechSynthesis;
        let ultimaDica = "";

        const dic = {
            "olhar": ["ver", "observar", "enxergar"],
            "feliz": ["alegre", "contente", "radiante"],
            "grande": ["enorme", "gigante", "imenso"],
            "medo": ["receio", "temor", "pavor"],
            "achar": ["encontrar", "localizar", "descobrir"]
        };

        function falar(t) {
            synth.cancel();
            const u = new SpeechSynthesisUtterance(t);
            u.lang = 'pt-BR';
            u.rate = 0.9; // Velocidade um pouco mais lenta para clareza
            synth.speak(u);
        }

        function tocarBipe() {
            const context = new (window.AudioContext || window.webkitAudioContext)();
            const osc = context.createOscillator();
            osc.connect(context.destination);
            osc.start(); osc.stop(context.currentTime + 0.1);
        }

        function mostrarAlerta(msg) {
            ultimaDica = msg;
            status.innerText = "üí° " + msg;
            status.classList.add('alerta');
            tocarBipe();
            falar(msg); // O computador fala a dica automaticamente
            setTimeout(() => status.classList.remove('alerta'), 4000);
        }

        // --- MONITOR DE ESCRITA ---
        campo.addEventListener('input', () => {
            const texto = campo.value;
            if (texto.length === 0) return;
            const ultChar = texto.slice(-1);

            // Regra: Mai√∫scula no in√≠cio
            if (texto.length === 1 && texto !== texto.toUpperCase()) {
                mostrarAlerta("Dica: Comece sua hist√≥ria com letra mai√∫scula.");
            }

            // Regra: Mai√∫scula ap√≥s pontua√ß√£o
            if (texto.length > 2 && texto.slice(-2, -1) === " ") {
                const charAntes = texto.slice(-3, -2);
                if ([".", "!", "?"].includes(charAntes) && ultChar !== ultChar.toUpperCase()) {
                    mostrarAlerta("Aten√ß√£o: Use letra mai√∫scula depois do ponto.");
                }
            }

            // Regra: Sin√¥nimos e V√≠rgulas
            if (ultChar === " ") {
                const palavras = texto.trim().split(/\s+/);
                const ultima = palavras[palavras.length - 1].toLowerCase().replace(/[.,!?;]/g, "");
                
                if (dic[ultima]) {
                    mostrarAlerta(`Voc√™ sabia? Existem outras palavras para ${ultima}. Aperte F3 para ouvir.`);
                }
                if (["mas", "porque", "ent√£o"].includes(ultima)) {
                    mostrarAlerta(`Dica: Que tal colocar uma v√≠rgula antes de ${ultima}?`);
                }
            }
        });

        // --- COMANDOS ATUALIZADOS ---

        function cmdDescrever() {
            const descricao = `
                Vou descrever as tr√™s cenas para voc√™. 
                Cena um: O In√≠cio. Um pequeno explorador de mochila e chap√©u encontra um pergaminho antigo de papel amarelado ca√≠do no ch√£o de uma floresta misteriosa. As √°rvores ao redor t√™m folhas de um tom azul brilhante.
                Cena dois: O Desafio. O explorador precisa atravessar uma ponte de cordas muito alta e balan√ßante. A ponte cruza um desfiladeiro profundo onde corre um rio l√° embaixo, cercado por n√©voa.
                Cena tr√™s: O Fim. Dentro de uma caverna iluminada por cristais roxos que brilham nas paredes, o explorador encontra um grande ba√∫ de madeira entalhada transbordando de moedas de ouro, joias e colares coloridos.
            `;
            falar(descricao);
        }

        function cmdLer() { falar(campo.value || "Voc√™ ainda n√£o escreveu nada."); }

        function cmdSinonimo() {
            const p = campo.value.trim().split(/\s+/);
            const u = p[p.length - 1]?.toLowerCase().replace(/[.,!?;]/g, "");
            if (dic[u]) {
                const msg = `Para a palavra ${u}, voc√™ pode usar: ${dic[u].join(", ")}`;
                falar(msg);
                status.innerText = msg;
            } else {
                falar("Ainda n√£o tenho sin√¥nimos para a √∫ltima palavra que voc√™ escreveu.");
            }
        }

        function cmdRepetirDica() {
            falar(ultimaDica || "Ainda n√£o tenho nenhuma dica para voc√™.");
        }

        function cmdSalvar() {
            const blob = new Blob([campo.value], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'historia.txt';
            a.click();
            falar("Sua hist√≥ria foi salva no computador.");
        }

        // ATALHOS DE TECLADO
        window.onkeydown = (e) => {
            if (e.keyCode === 112) { e.preventDefault(); cmdDescrever(); } // F1
            if (e.keyCode === 113) { e.preventDefault(); cmdLer(); }       // F2
            if (e.keyCode === 114) { e.preventDefault(); cmdSinonimo(); }  // F3
            if (e.keyCode === 115) { e.preventDefault(); cmdSalvar(); }    // F4
            if (e.keyCode === 119) { e.preventDefault(); cmdRepetirDica(); } // F8
        };
    </script>
</body>
</html>
