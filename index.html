<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Teste de Voz - Narrativa</title>
    <style>
        body { font-family: sans-serif; background: #eef2f3; text-align: center; padding: 20px; }
        #btnStart { background: #ce1212; color: white; padding: 20px 40px; font-size: 1.5rem; border: none; border-radius: 50px; cursor: pointer; }
        #statusVoz { font-weight: bold; color: #333; margin: 20px; padding: 15px; background: white; border: 2px dashed #007bff; display: inline-block; min-width: 300px; }
        .log-erro { color: red; font-size: 0.8rem; margin-top: 10px; }
        textarea { width: 80%; height: 150px; margin-top: 20px; font-size: 1.2rem; }
    </style>
</head>
<body>

    <button id="btnStart">ATIVAR MICROFONE</button>
    <br>
    <div id="statusVoz">Clique no botão para iniciar</div>
    <div id="logErro" class="log-erro"></div>

    <br>
    <textarea id="campo"></textarea>

    <script>
        const statusVoz = document.getElementById('statusVoz');
        const logErro = document.getElementById('logErro');
        const btn = document.getElementById('btnStart');
        const synth = window.speechSynthesis;

        // Tenta capturar a API de reconhecimento
        const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        
        if (!Recognition) {
            statusVoz.innerText = "ERRO: Seu navegador não suporta voz.";
        }

        const recognition = new Recognition();
        recognition.lang = 'pt-BR';
        recognition.continuous = false;
        recognition.interimResults = false;

        btn.onclick = () => {
            try {
                recognition.start();
                statusVoz.innerText = "ESCUTANDO AGORA... FALE ALGO!";
                btn.style.background = "#28a745";
                btn.innerText = "MICROFONE LIGADO";
            } catch (e) {
                logErro.innerText = "Erro ao iniciar: " + e.message;
            }
        };

        recognition.onresult = (event) => {
            const fala = event.results[0][0].transcript;
            statusVoz.innerText = "EU OUVI: " + fala;
            
            // Lógica simples de comando
            if (fala.toLowerCase().includes("descrever")) {
                const u = new SpeechSynthesisUtterance("Vou descrever as cenas para você.");
                u.lang = 'pt-BR';
                synth.speak(u);
            }
        };

        recognition.onerror = (event) => {
            logErro.innerText = "Erro do Sistema: " + event.error;
            // Se o erro for 'no-speech', apenas reinicia
            if (event.error === 'no-speech') {
                setTimeout(() => recognition.start(), 1000);
            }
        };

        recognition.onend = () => {
            // Reinicia sempre que parar
            if (btn.innerText === "MICROFONE LIGADO") {
                recognition.start();
            }
        };
    </script>
</body>
</html>
