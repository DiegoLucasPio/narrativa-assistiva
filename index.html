<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Narrativa Inclusiva - Com Alerta Sonoro</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f4f8; text-align: center; padding: 10px; }
        .painel { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .btn { padding: 15px 20px; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; color: white; transition: 0.2s; }
        .btn-v { background: #e74c3c; } .btn-a { background: #3498db; } .btn-g { background: #27ae60; } .btn-p { background: #9b59b6; } .btn-o { background: #f39c12; }
        
        .quadros { display: flex; justify-content: center; gap: 15px; margin: 20px 0; }
        .cena { width: 260px; background: white; border-radius: 12px; padding: 12px; border: 3px solid #cfe2ff; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
        .cena img { width: 100%; height: 160px; object-fit: cover; border-radius: 8px; }
        .cena strong { display: block; margin-top: 10px; color: #084298; font-size: 1.1rem; }
        
        textarea { width: 90%; height: 180px; font-size: 1.7rem; padding: 15px; border: 4px solid #3498db; border-radius: 15px; margin-top: 10px; outline: none; }
        #status { margin: 10px; font-weight: bold; color: #2c3e50; background: #fff; display: inline-block; padding: 8px 20px; border-radius: 30px; border: 1px solid #ddd; }
    </style>
</head>
<body>

    <div id="status">Escreva sua hist√≥ria! (F1, F2, F3, F4 para atalhos)</div>

    <div class="painel">
        <button class="btn btn-v" onclick="ativarVoz()">üé§ VOZ</button>
        <button class="btn btn-a" onclick="cmdDescrever()">üñºÔ∏è CENAS (F1)</button>
        <button class="btn btn-g" onclick="cmdLer()">üìñ LER (F2)</button>
        <button class="btn btn-p" onclick="cmdSinonimo()">üîÑ SIN√îNIMO (F3)</button>
        <button class="btn btn-o" onclick="cmdSalvar()">üíæ SALVAR (F4)</button>
    </div>

    <div class="quadros">
        <div class="cena">
            <img src="https://images.unsplash.com/photo-1519074063912-ad25b5ce4970?w=400">
            <strong>1. O In√≠cio</strong>
            <p style="font-size: 0.9rem;">O explorador encontra um mapa antigo na floresta.</p>
        </div>
        <div class="cena">
            <img src="https://images.unsplash.com/photo-1444076784383-69fc7bad9006?w=400">
            <strong>2. O Meio</strong>
            <p style="font-size: 0.9rem;">Ele precisa atravessar uma ponte muito perigosa.</p>
        </div>
        <div class="cena">
            <img src="https://images.unsplash.com/photo-1509114397022-ed747cca3f65?w=400">
            <strong>3. O Fim</strong>
            <p style="font-size: 0.9rem;">Ele descobre o ba√∫ de ouro dentro da caverna.</p>
        </div>
    </div>

    <textarea id="txt" placeholder="Digite aqui... (Ouvir√° um sinal se houver sin√¥nimo)"></textarea>

    <script>
        const campo = document.getElementById('txt');
        const status = document.getElementById('status');
        const synth = window.speechSynthesis;

        // DICION√ÅRIO EXPANDIDO
        const dic = {
            "olhar": ["ver", "observar", "enxergar"],
            "feliz": ["alegre", "contente", "radiante"],
            "triste": ["chateado", "desanimado", "tristonho"],
            "medo": ["receio", "temor", "pavor"],
            "grande": ["enorme", "imenso", "gigante"],
            "pequeno": ["min√∫sculo", "mi√∫do", "baixinho"],
            "bonito": ["lindo", "belo", "encantador"],
            "casa": ["lar", "moradia", "resid√™ncia"],
            "achar": ["encontrar", "localizar", "descobrir"],
            "caminhar": ["andar", "marchar", "seguir"],
            "falar": ["dizer", "contar", "exclamar"],
            "bravo": ["irritado", "furioso", "zangado"],
            "amigo": ["colega", "parceiro", "companheiro"],
            "ouro": ["tesouro", "riqueza", "moedas"],
            "mapa": ["guia", "pergaminho", "planta"],
            "ponte": ["passarela", "pinguela", "travessia"],
            "caverna": ["gruta", "fenda", "toca"],
            "perigoso": ["arriscado", "assustador", "incerto"]
        };

        // --- FUN√á√ÉO DO SINAL SONORO (BIPE) ---
        function tocarBipe() {
            const context = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = context.createOscillator();
            const gain = context.createGain();

            oscillator.type = "sine";
            oscillator.frequency.setValueAtTime(587.33, context.currentTime); // Nota R√© (suave)
            gain.gain.setValueAtTime(0.1, context.currentTime); // Volume baixo

            oscillator.connect(gain);
            gain.connect(context.destination);

            oscillator.start();
            oscillator.stop(context.currentTime + 0.15); // Dura√ß√£o curta
        }

        // MONITOR DE DIGITA√á√ÉO
        campo.addEventListener('input', (e) => {
            const texto = campo.value;
            // Se o √∫ltimo caractere for um espa√ßo ou pontua√ß√£o, verificamos a palavra
            if (texto.endsWith(" ") || texto.endsWith(".") || texto.endsWith(",")) {
                const palavras = texto.trim().split(/\s+/);
                const ultima = palavras[palavras.length - 1].toLowerCase().replace(/[.,!?;]/g, "");
                
                if (dic[ultima]) {
                    tocarBipe(); // Toca o sinal sonoro!
                    status.innerText = "üí° Sin√¥nimo dispon√≠vel para: " + ultima;
                }
            }
        });

        function falar(t) {
            synth.cancel();
            const u = new SpeechSynthesisUtterance(t);
            u.lang = 'pt-BR';
            synth.speak(u);
        }

        function cmdDescrever() {
            falar("Cena 1: O explorador acha um mapa. Cena 2: Ele atravessa uma ponte. Cena 3: Ele encontra o tesouro.");
        }

        function cmdLer() { falar(campo.value || "Nada escrito."); }

        function cmdSinonimo() {
            const palavras = campo.value.trim().split(/\s+/);
            const ultima = palavras[palavras.length - 1]?.toLowerCase().replace(/[.,!?;]/g, "");
            
            if (dic[ultima]) {
                const lista = dic[ultima].join(", ");
                falar(`Para ${ultima}, voc√™ pode usar: ${lista}`);
                status.innerText = `Op√ß√µes para ${ultima}: ${lista}`;
            } else {
                falar("Ainda n√£o conhe√ßo sin√¥nimos para " + (ultima || "esta palavra"));
            }
        }

        function cmdSalvar() {
            const blob = new Blob([campo.value], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'minha_historia.txt';
            a.click();
            falar("Hist√≥ria salva.");
        }

        window.onkeydown = (e) => {
            if (e.keyCode === 112) { e.preventDefault(); cmdDescrever(); }
            if (e.keyCode === 113) { e.preventDefault(); cmdLer(); }
            if (e.keyCode === 114) { e.preventDefault(); cmdSinonimo(); }
            if (e.keyCode === 115) { e.preventDefault(); cmdSalvar(); }
        };

        function ativarVoz() {
            const Rec = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!Rec) return;
            const r = new Rec();
            r.lang = 'pt-BR';
            r.onstart = () => status.innerText = "üé§ Ouvindo...";
            r.onresult = (e) => {
                const f = e.results[0][0].transcript.toLowerCase();
                if (f.includes("descrever")) cmdDescrever();
                else if (f.includes("ler")) cmdLer();
                else if (f.includes("sin√¥nimo")) cmdSinonimo();
                else if (f.includes("salvar")) cmdSalvar();
            };
            r.start();
        }
    </script>
</body>
</html>
