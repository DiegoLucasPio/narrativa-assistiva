<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Narrativa Inclusiva - Assistente Robusto</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f4f8; text-align: center; padding: 10px; }
        .painel { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .btn { padding: 12px 18px; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; color: white; transition: 0.2s; font-size: 0.9rem; }
        .btn-v { background: #e74c3c; } .btn-a { background: #3498db; } .btn-g { background: #27ae60; } .btn-p { background: #9b59b6; } .btn-o { background: #f39c12; }
        
        .quadros { display: flex; justify-content: center; gap: 10px; margin: 15px 0; }
        .cena { width: 250px; background: white; border-radius: 12px; padding: 12px; border: 3px solid #cfe2ff; }
        .cena img { width: 100%; height: 140px; object-fit: cover; border-radius: 8px; }
        
        textarea { width: 90%; height: 200px; font-size: 1.7rem; padding: 15px; border: 4px solid #3498db; border-radius: 15px; margin-top: 10px; outline: none; }
        #status { margin: 10px; font-weight: bold; color: #2c3e50; background: #fff; display: inline-block; padding: 10px 25px; border-radius: 30px; border: 2px solid #3498db; min-height: 1.5em; }
        .sugestao-ativa { background: #fff3cd !important; color: #856404 !important; border-color: #ffeeba !important; }
    </style>
</head>
<body>

    <div id="status">Escreva sua aventura...</div>

    <div class="painel">
        <button class="btn btn-v" onclick="ativarVoz()">ğŸ¤ VOZ</button>
        <button class="btn btn-a" onclick="cmdDescrever()">ğŸ–¼ï¸ CENAS (F1)</button>
        <button class="btn btn-g" onclick="cmdLer()">ğŸ“– LER (F2)</button>
        <button class="btn btn-p" onclick="cmdSinonimo()">ğŸ”„ SINÃ”NIMO (F3)</button>
        <button class="btn btn-o" onclick="cmdSalvar()">ğŸ’¾ SALVAR (F4)</button>
    </div>

    <div class="quadros">
        <div class="cena"><img src="https://images.unsplash.com/photo-1519074063912-ad25b5ce4970?w=400"><strong>1. O InÃ­cio</strong></div>
        <div class="cena"><img src="https://images.unsplash.com/photo-1444076784383-69fc7bad9006?w=400"><strong>2. O Meio</strong></div>
        <div class="cena"><img src="https://images.unsplash.com/photo-1509114397022-ed747cca3f65?w=400"><strong>3. O Fim</strong></div>
    </div>

    <textarea id="txt" placeholder="Dica: Comece com letra maiÃºscula!"></textarea>

    <script>
        const campo = document.getElementById('txt');
        const status = document.getElementById('status');
        const synth = window.speechSynthesis;

        const dic = {
            "olhar": ["ver", "observar", "enxergar"], "feliz": ["alegre", "contente"], 
            "grande": ["enorme", "gigante"], "casa": ["lar", "moradia"],
            "mapa": ["guia", "pergaminho"], "ponte": ["travessia", "passarela"]
        };

        function tocarBipe(tipo = "suave") {
            const context = new (window.AudioContext || window.webkitAudioContext)();
            const osc = context.createOscillator();
            const gain = context.createGain();
            osc.type = "sine";
            osc.frequency.setValueAtTime(tipo === "alerta" ? 440 : 587, context.currentTime);
            gain.gain.setValueAtTime(0.05, context.currentTime);
            osc.connect(gain); gain.connect(context.destination);
            osc.start(); osc.stop(context.currentTime + 0.1);
        }

        function falar(t) {
            synth.cancel();
            const u = new SpeechSynthesisUtterance(t);
            u.lang = 'pt-BR';
            synth.speak(u);
        }

        // --- MOTOR DE ASSISTÃŠNCIA GRAMATICAL ---
        campo.addEventListener('input', () => {
            const texto = campo.value;
            const ultChar = texto.slice(-1);
            
            // 1. VerificaÃ§Ã£o de InÃ­cio de Frase (MaiÃºscula)
            if (texto.length === 1 && texto === texto.toLowerCase() && texto !== " ") {
                status.innerText = "ğŸ’¡ Dica: Que tal comeÃ§ar com letra MaiÃºscula?";
                status.classList.add('sugestao-ativa');
                tocarBipe("alerta");
            }

            // 2. VerificaÃ§Ã£o ao pressionar EspaÃ§o (VÃ­rgulas e SinÃ´nimos)
            if (ultChar === " ") {
                const palavras = texto.trim().split(/\s+/);
                const ultima = palavras[palavras.length - 1].toLowerCase().replace(/[.,!?;]/g, "");
                
                // SugestÃ£o de VÃ­rgula antes de conectivos
                const conectivos = ["mas", "porque", "pois", "porem", "entÃ£o"];
                if (conectivos.includes(ultima)) {
                    status.innerText = `ğŸ’¡ Dica: Quase sempre usamos vÃ­rgula antes de "${ultima}".`;
                    tocarBipe();
                }

                // SinÃ´nimos (jÃ¡ existente)
                if (dic[ultima]) {
                    status.innerText = `âœ¨ SinÃ´nimo para ${ultima}: aperte F3.`;
                    tocarBipe();
                }
            }

            // 3. SugestÃ£o de ParÃ¡grafo (Texto muito longo)
            const frases = texto.split(/[.!?]/);
            const ultimaFrase = frases[frases.length - 1];
            if (ultimaFrase.length > 150) {
                status.innerText = "ğŸ’¡ O texto estÃ¡ longo. Que tal um ponto final?";
                tocarBipe("alerta");
            }

            // Limpa o status se o usuÃ¡rio comeÃ§ar a corrigir
            if (ultChar === "\n") {
                status.innerText = "Novo parÃ¡grafo! Muito bem.";
                status.classList.remove('sugestao-ativa');
            }
        });

        // FunÃ§Ãµes de comando mantidas
        function cmdDescrever() { falar("Cena 1: O mapa. Cena 2: A ponte. Cena 3: O tesouro."); }
        function cmdLer() { falar(campo.value || "Nada escrito."); }
        function cmdSinonimo() {
            const p = campo.value.trim().split(/\s+/);
            const u = p[p.length - 1]?.toLowerCase().replace(/[.,!?;]/g, "");
            if (dic[u]) { falar(`Para ${u}, use: ${dic[u].join(", ")}`); }
        }
        function cmdSalvar() { /* ... cÃ³digo de salvar anterior ... */ }

        window.onkeydown = (e) => {
            if (e.keyCode === 112) { e.preventDefault(); cmdDescrever(); }
            if (e.keyCode === 113) { e.preventDefault(); cmdLer(); }
            if (e.keyCode === 114) { e.preventDefault(); cmdSinonimo(); }
            if (e.keyCode === 115) { e.preventDefault(); cmdSalvar(); }
        };
        
        function ativarVoz() { /* Mantido apenas como reserva */
            const Rec = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!Rec) return;
            const r = new Rec(); r.lang = 'pt-BR';
            r.onresult = (e) => { const f = e.results[0][0].transcript.toLowerCase(); if(f.includes("ler")) cmdLer(); };
            r.start();
        }
    </script>
</body>
</html>
