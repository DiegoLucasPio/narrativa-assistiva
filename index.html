<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Narrativa Assistiva - Revisor Proativo</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f4f8; text-align: center; padding: 10px; }
        .painel { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .btn { padding: 12px 18px; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; color: white; transition: 0.2s; font-size: 0.9rem; }
        .btn-v { background: #e74c3c; } .btn-a { background: #3498db; } .btn-g { background: #27ae60; } .btn-p { background: #9b59b6; } .btn-o { background: #f39c12; }
        
        .quadros { display: flex; justify-content: center; gap: 10px; margin: 15px 0; }
        .cena { width: 250px; background: white; border-radius: 12px; padding: 12px; border: 3px solid #cfe2ff; }
        .cena img { width: 100%; height: 140px; object-fit: cover; border-radius: 8px; }
        
        textarea { width: 90%; height: 200px; font-size: 1.7rem; padding: 15px; border: 4px solid #3498db; border-radius: 15px; margin-top: 10px; outline: none; }
        #status { margin: 10px; font-weight: bold; color: #2c3e50; background: #fff; display: inline-block; padding: 10px 25px; border-radius: 30px; border: 2px solid #3498db; min-height: 1.5em; transition: 0.3s; }
        .alerta { background: #fff3cd !important; border-color: #ffc107 !important; color: #856404 !important; transform: scale(1.05); }
    </style>
</head>
<body>

    <div id="status">Escreva sua hist√≥ria...</div>

    <div class="painel">
        <button class="btn btn-v" onclick="ativarVoz()">üé§ VOZ</button>
        <button class="btn btn-a" onclick="cmdDescrever()">üñºÔ∏è CENAS (F1)</button>
        <button class="btn btn-g" onclick="cmdLer()">üìñ LER (F2)</button>
        <button class="btn btn-p" onclick="cmdSinonimo()">üîÑ SIN√îNIMO (F3)</button>
        <button class="btn btn-o" onclick="cmdSalvar()">üíæ SALVAR (F4)</button>
    </div>

    <div class="quadros">
        <div class="cena"><img src="https://images.unsplash.com/photo-1519074063912-ad25b5ce4970?w=400"><strong>1. O Mapa</strong></div>
        <div class="cena"><img src="https://images.unsplash.com/photo-1444076784383-69fc7bad9006?w=400"><strong>2. A Ponte</strong></div>
        <div class="cena"><img src="https://images.unsplash.com/photo-1509114397022-ed747cca3f65?w=400"><strong>3. O Tesouro</strong></div>
    </div>

    <textarea id="txt" placeholder="Dica: Use pontos e letras mai√∫sculas!"></textarea>

    <script>
        const campo = document.getElementById('txt');
        const status = document.getElementById('status');
        const synth = window.speechSynthesis;

        const dic = {
            "olhar": ["ver", "observar", "enxergar"], "feliz": ["alegre", "contente"], 
            "grande": ["enorme", "gigante"], "casa": ["lar", "moradia"],
            "mapa": ["guia", "pergaminho"], "ponte": ["travessia", "passarela"],
            "medo": ["receio", "temor"], "achar": ["encontrar", "descobrir"]
        };

        function tocarBipe(frequencia = 587) {
            try {
                const context = new (window.AudioContext || window.webkitAudioContext)();
                const osc = context.createOscillator();
                const gain = context.createGain();
                osc.type = "sine";
                osc.frequency.setValueAtTime(frequencia, context.currentTime);
                gain.gain.setValueAtTime(0.05, context.currentTime);
                osc.connect(gain); gain.connect(context.destination);
                osc.start(); osc.stop(context.currentTime + 0.1);
            } catch(e) { console.log("√Åudio bloqueado pelo navegador."); }
        }

        function mostrarAlerta(msg) {
            status.innerText = "üí° " + msg;
            status.classList.add('alerta');
            tocarBipe(440); // Som mais grave para aten√ß√£o
            setTimeout(() => status.classList.remove('alerta'), 3000);
        }

        campo.addEventListener('input', () => {
            const texto = campo.value;
            if (texto.length === 0) return;

            const ultChar = texto.slice(-1);
            const penultChar = texto.slice(-2, -1);

            // 1. Verifica√ß√£o de In√≠cio de Frase (Logo na primeira letra)
            if (texto.length === 1 && texto !== texto.toUpperCase()) {
                mostrarAlerta("Comece a hist√≥ria com letra Mai√∫scula!");
            }

            // 2. Verifica√ß√£o ap√≥s Ponto Final, Exclama√ß√£o ou Interroga√ß√£o
            // Se o usu√°rio digitou uma letra ap√≥s um sinal de pontua√ß√£o e um espa√ßo
            if (penultChar === " " && texto.length > 2) {
                const charAntesDoEspaco = texto.slice(-3, -2);
                if ([".", "!", "?", "\n"].includes(charAntesDoEspaco)) {
                    if (ultChar !== ultChar.toUpperCase() && ultChar !== " ") {
                        mostrarAlerta("Ap√≥s o ponto, use letra Mai√∫scula.");
                    }
                }
            }

            // 3. Sugest√£o de V√≠rgula (Conectivos)
            if (ultChar === " ") {
                const palavras = texto.trim().split(/\s+/);
                const ultima = palavras[palavras.length - 1].toLowerCase().replace(/[.,!?;]/g, "");
                
                const conectivos = ["mas", "porque", "ent√£o", "pois", "por√©m"];
                if (conectivos.includes(ultima)) {
                    mostrarAlerta(`Que tal uma v√≠rgula antes de "${ultima}"?`);
                }

                if (dic[ultima]) {
                    tocarBipe(880); // Som agudo para "descoberta" de sin√¥nimo
                    status.innerText = `‚ú® Sin√¥nimo para "${ultima}" dispon√≠vel! (F3)`;
                }
            }

            // 4. Sugest√£o de Ponto Final (Frase muito longa)
            const frases = texto.split(/[.!?\n]/);
            const ultimaFrase = frases[frases.length - 1];
            if (ultimaFrase.length > 120) {
                mostrarAlerta("Essa frase est√° longa. Use um ponto final para respirar.");
            }
        });

        // Fun√ß√µes de comando
        function falar(t) { synth.cancel(); const u = new SpeechSynthesisUtterance(t); u.lang='pt-BR'; synth.speak(u); }
        function cmdDescrever() { falar("Cena 1: O mapa. Cena 2: A ponte. Cena 3: O tesouro."); }
        function cmdLer() { falar(campo.value || "Nada escrito."); }
        function cmdSinonimo() {
            const p = campo.value.trim().split(/\s+/);
            const u = p[p.length - 1]?.toLowerCase().replace(/[.,!?;]/g, "");
            if (dic[u]) { falar(`Para ${u}, use: ${dic[u].join(", ")}`); }
        }
        function cmdSalvar() {
            const blob = new Blob([campo.value], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'minha_historia.txt';
            a.click();
            falar("Hist√≥ria salva.");
        }

        window.onkeydown = (e) => {
            if (e.keyCode === 112) { e.preventDefault(); cmdDescrever(); }
            if (e.keyCode === 113) { e.preventDefault(); cmdLer(); }
            if (e.keyCode === 114) { e.preventDefault(); cmdSinonimo(); }
            if (e.keyCode === 115) { e.preventDefault(); cmdSalvar(); }
        };

        function ativarVoz() { 
            // Apenas para manter a interface, j√° que o servi√ßo do Google est√° com erro no seu PC
            status.innerText = "Modo de voz aguardando sistema..."; 
        }
    </script>
</body>
</html>
