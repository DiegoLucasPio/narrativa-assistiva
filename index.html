<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Hist√≥ria do Passarinho - Est√°vel</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #eef9ff; text-align: center; padding: 10px; }
        .painel { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .btn { padding: 12px 18px; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; color: white; transition: 0.2s; font-size: 0.9rem; }
        .btn-a { background: #3498db; } .btn-g { background: #27ae60; } .btn-p { background: #9b59b6; } .btn-v { background: #e67e22; } .btn-o { background: #7f8c8d; }
        
        .quadros { display: flex; justify-content: center; gap: 15px; margin: 20px 0; }
        .cena { width: 260px; background: white; border-radius: 12px; padding: 15px; border: 3px solid #b3e5fc; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
        /* Estilo para os desenhos em c√≥digo */
        .icon-box { width: 100%; height: 150px; display: flex; align-items: center; justify-content: center; background: #f8f9fa; border-radius: 8px; }
        svg { width: 100px; height: 100px; }
        
        textarea { width: 90%; height: 200px; font-size: 1.8rem; padding: 15px; border: 4px solid #03a9f4; border-radius: 15px; margin-top: 10px; outline: none; }
        #status { margin: 10px; font-weight: bold; color: #2c3e50; background: #fff; display: inline-block; padding: 10px 25px; border-radius: 30px; border: 2px solid #03a9f4; min-height: 1.5em; }
        .alerta { background: #fff9c4 !important; border-color: #fbc02d !important; }
    </style>
</head>
<body>

    <div id="status">Escreva a hist√≥ria do passarinho. Use F1 para ouvir as cenas.</div>

    <div class="painel">
        <button class="btn btn-a" onclick="cmdDescrever()">üñºÔ∏è O QUE ACONTECE? (F1)</button>
        <button class="btn btn-g" onclick="cmdLer()">üìñ LER TEXTO (F2)</button>
        <button class="btn btn-p" onclick="cmdSinonimo()">üîÑ OUTRAS PALAVRAS (F3)</button>
        <button class="btn btn-v" onclick="cmdRepetirDica()">üí° REPETIR DICA (F8)</button>
        <button class="btn btn-o" onclick="cmdSalvar()">üíæ SALVAR (F4)</button>
    </div>

    <div class="quadros">
        <div class="cena">
            <div class="icon-box">
                <svg viewBox="0 0 24 24" fill="none" stroke="#555" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 21h18M5 21V7a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v14M9 21V5M15 21V5M5 10h14M5 15h14"/>
                    <circle cx="12" cy="12" r="2" fill="#3498db"/>
                </svg>
            </div>
            <strong>1. O p√°ssaro est√° preso na gaiola.</strong>
        </div>

        <div class="cena">
            <div class="icon-box">
                <svg viewBox="0 0 24 24" fill="none" stroke="#555" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 21h18M5 21V7a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v14M9 21V5M15 21V5"/>
                    <path d="M19 12l-4-4m0 8l4-4h-8" stroke="#e67e22"/>
                </svg>
            </div>
            <strong>2. A porta abriu e ele saiu voando.</strong>
        </div>

        <div class="cena">
            <div class="icon-box">
                <svg viewBox="0 0 24 24" fill="none" stroke="#27ae60" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 20c5 0 8-3 11-7m0 0c3-4 6-4 8-4M14 13c1 2 3 3 5 3"/>
                    <path d="M15 5v2M18 3v2" stroke="#9b59b6"/>
                    <circle cx="16" cy="10" r="3" fill="#3498db"/>
                </svg>
            </div>
            <strong>3. Agora ele canta livre na √°rvore.</strong>
        </div>
    </div>

    <textarea id="txt" placeholder="Dica: Comece com letra Mai√∫scula!"></textarea>

    <script>
        const campo = document.getElementById('txt');
        const status = document.getElementById('status');
        const synth = window.speechSynthesis;
        let ultimaDica = "";

        const dic = {
            "p√°ssaro": ["passarinho", "ave", "amiguinho"],
            "triste": ["chateado", "preso", "quieto"],
            "feliz": ["alegre", "contente", "livre"],
            "voar": ["bater asas", "subir", "partir"],
            "cantar": ["assobiar", "gorjear"],
            "gaiola": ["pris√£o", "casinha de ferro"]
        };

        function falar(t) {
            synth.cancel();
            const u = new SpeechSynthesisUtterance(t);
            u.lang = 'pt-BR';
            u.rate = 0.9;
            synth.speak(u);
        }

        function tocarBipe() {
            const context = new (window.AudioContext || window.webkitAudioContext)();
            const osc = context.createOscillator();
            osc.connect(context.destination);
            osc.start(); osc.stop(context.currentTime + 0.1);
        }

        function mostrarAlerta(msg) {
            if (ultimaDica === msg) return;
            ultimaDica = msg;
            status.innerText = "üí° " + msg;
            status.classList.add('alerta');
            tocarBipe();
            falar(msg);
            setTimeout(() => status.classList.remove('alerta'), 4000);
        }

        campo.addEventListener('input', () => {
            const texto = campo.value;
            if (texto.length === 0) { ultimaDica = ""; return; }
            const ultChar = texto.slice(-1);

            if (texto.length === 1 && texto !== texto.toUpperCase()) {
                mostrarAlerta("Dica: Comece com letra mai√∫scula.");
            }

            if (ultChar === " ") {
                const trecho = texto.trim();
                const palavras = trecho.split(/\s+/);
                const ultima = palavras[palavras.length - 1].toLowerCase().replace(/[.,!?;]/g, "");
                
                if (["mas", "porque", "ent√£o"].includes(ultima)) {
                    const regex = new RegExp(`,\\s*${ultima}$`, 'i');
                    if (!regex.test(trecho)) mostrarAlerta(`Coloque uma v√≠rgula antes de ${ultima}.`);
                }

                if (dic[ultima]) mostrarAlerta(`Aperte F3 para ouvir outros nomes para ${ultima}.`);
            }

            if (texto.length > 2 && texto.slice(-2, -1) === " ") {
                const charAnterior = texto.slice(-3, -2);
                if ([".", "!", "?"].includes(charAnterior) && ultChar !== ultChar.toUpperCase() && ultChar !== " ") {
                    mostrarAlerta("Use letra mai√∫scula depois do ponto.");
                }
            }
        });

        function cmdDescrever() {
            falar(`
                Vou descrever os tr√™s quadros da hist√≥ria do passarinho. 
                Quadro um: H√° uma gaiola cinza com grades bem fechadas. L√° dentro, o passarinho azul est√° preso. 
                Quadro dois: A porta da gaiola est√° aberta. Uma seta mostra o passarinho saindo e voando para longe. 
                Quadro tr√™s: O passarinho est√° pousado sobre o galho verde de uma √°rvore. Existem notas musicais saindo do seu biquinho, porque ele est√° cantando de felicidade.
            `);
        }

        function cmdLer() { falar(campo.value || "N√£o h√° nada escrito."); }

        function cmdSinonimo() {
            const p = campo.value.trim().split(/\s+/);
            const u = p[p.length - 1]?.toLowerCase().replace(/[.,!?;]/g, "");
            if (dic[u]) falar(`Pode usar: ${dic[u].join(", ")}`);
        }

        function cmdRepetirDica() { falar(ultimaDica || "N√£o tenho dicas agora."); }

        function cmdSalvar() {
            const blob = new Blob([campo.value], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'minha_historia.txt';
            a.click();
            falar("Hist√≥ria salva com sucesso.");
        }

        window.onkeydown = (e) => {
            if (e.keyCode === 112) { e.preventDefault(); cmdDescrever(); }
            if (e.keyCode === 113) { e.preventDefault(); cmdLer(); }
            if (e.keyCode === 114) { e.preventDefault(); cmdSinonimo(); }
            if (e.keyCode === 115) { e.preventDefault(); cmdSalvar(); }
            if (e.keyCode === 119) { e.preventDefault(); cmdRepetirDica(); }
        };
    </script>
</body>
</html>
